import re

SECTION_EMOJI_MAP = {
    'Big Tech': 'ğŸ¢',
    'Startups': 'ğŸš€',
    'Science': 'ğŸ”¬',
    'Programming': 'ğŸ‘¨â€ğŸ’»',
    'Design': 'ğŸ¨',
    'Data Science': 'ğŸ“Š',
    'Miscellaneous': 'ğŸ“Œ',
    'Quick Links': 'ğŸ”—',
    'Futuristic Technology': 'ğŸ¤–',
    'Tech': 'ğŸ’»',
    'AI': 'ğŸ¤–',
    'Web': 'ğŸŒ',
    'Crypto': 'ğŸ’°',
    'Mobile': 'ğŸ“±',
    'Security': 'ğŸ”’',
    'Cloud': 'â˜ï¸',
    'Gaming': 'ğŸ®',
    'Hardware': 'ğŸ”§',
    'å¤§ç§‘æŠ€': 'ğŸ¢',
    'ç§‘æŠ€': 'ğŸ’»',
    'åˆ›ä¸š': 'ğŸš€',
    'ç§‘å­¦': 'ğŸ”¬',
    'ç¼–ç¨‹': 'ğŸ‘¨â€ğŸ’»',
    'è®¾è®¡': 'ğŸ¨',
    'æ•°æ®ç§‘å­¦': 'ğŸ“Š',
    'å…¶ä»–': 'ğŸ“Œ',
    'å¿«é€Ÿé“¾æ¥': 'ğŸ”—',
    'æœªæ¥ç§‘æŠ€': 'ğŸ¤–',
    'äººå·¥æ™ºèƒ½': 'ğŸ¤–',
    'ç½‘ç»œ': 'ğŸŒ',
    'åŠ å¯†è´§å¸': 'ğŸ’°',
    'ç§»åŠ¨': 'ğŸ“±',
    'å®‰å…¨': 'ğŸ”’',
    'äº‘è®¡ç®—': 'â˜ï¸',
    'æ¸¸æˆ': 'ğŸ®',
    'ç¡¬ä»¶': 'ğŸ”§'
}

TITLE_KEYWORD_EMOJI_MAP = {
    # å…¬å¸
    'Apple': 'ğŸ',
    'Google': 'ğŸ”',
    'Microsoft': 'âŠ',
    'Meta': 'ğŸ‘“',
    'Twitter': 'ğŸ¦',
    'Amazon': 'ğŸ“¦',
    'Netflix': 'ğŸ¬',
    'Tesla': 'ğŸš—',
    'SpaceX': 'ğŸš€',
    'OpenAI': 'ğŸ¤–',
    'Android': 'ğŸ¤–',
    'iOS': 'ğŸ',
    
    # ä¸­æ–‡å…¬å¸å
    'è‹¹æœ': 'ğŸ',
    'è°·æ­Œ': 'ğŸ”',
    'å¾®è½¯': 'âŠ',
    'å…ƒå®‡å®™': 'ğŸ‘“',
    'æ¨ç‰¹': 'ğŸ¦',
    'äºšé©¬é€Š': 'ğŸ“¦',
    'ç½‘é£': 'ğŸ¬',
    'ç‰¹æ–¯æ‹‰': 'ğŸš—',
    
    # æŠ€æœ¯è¯æ±‡
    'AI': 'ğŸ¤–',
    'ChatGPT': 'ğŸ¤–',
    'Machine Learning': 'ğŸ§ ',
    'Blockchain': 'â›“ï¸',
    'Bitcoin': 'â‚¿',
    'Cloud': 'â˜ï¸',
    'Database': 'ğŸ’¾',
    'API': 'ğŸ”Œ',
    'Mobile': 'ğŸ“±',
    'Security': 'ğŸ”’',
    'Privacy': 'ğŸ”',
    'Web': 'ğŸŒ',
    'Browser': 'ğŸŒ',
    'Robot': 'ğŸ¤–',
    'Digital': 'ğŸ”¢',
    'Rocket': 'ğŸš€',
    'RoboTaxi': 'ğŸ¤–ğŸš•',
    'Self-driving': 'ğŸš™',
    'Autonomous': 'ğŸš™',
    
    # ä¸­æ–‡æŠ€æœ¯è¯æ±‡
    'äººå·¥æ™ºèƒ½': 'ğŸ¤–',
    'æœºå™¨å­¦ä¹ ': 'ğŸ§ ',
    'åŒºå—é“¾': 'â›“ï¸',
    'æ¯”ç‰¹å¸': 'â‚¿',
    'äº‘': 'â˜ï¸',
    'æ•°æ®åº“': 'ğŸ’¾',
    'æ¥å£': 'ğŸ”Œ',
    'ç§»åŠ¨': 'ğŸ“±',
    'å®‰å…¨': 'ğŸ”’',
    'éšç§': 'ğŸ”',
    'ç½‘ç»œ': 'ğŸŒ',
    'æµè§ˆå™¨': 'ğŸŒ',
    'æœºå™¨äºº': 'ğŸ¤–',
    'æ•°å­—': 'ğŸ”¢',
    'ç«ç®­': 'ğŸš€',
    'è‡ªåŠ¨é©¾é©¶': 'ğŸš™',
    'æ— äººé©¾é©¶': 'ğŸš™',
    'æœºå™¨äººå‡ºç§Ÿè½¦': 'ğŸ¤–ğŸš•',
    
    # å›½å®¶
    'USA': 'ğŸ‡ºğŸ‡¸',
    'China': 'ğŸ‡¨ğŸ‡³',
    'Japan': 'ğŸ‡¯ğŸ‡µ',
    'Korea': 'ğŸ‡°ğŸ‡·',
    'India': 'ğŸ‡®ğŸ‡³',
    'UK': 'ğŸ‡¬ğŸ‡§',
    'Germany': 'ğŸ‡©ğŸ‡ª',
    'France': 'ğŸ‡«ğŸ‡·',
    'Russia': 'ğŸ‡·ğŸ‡º',
    'Canada': 'ğŸ‡¨ğŸ‡¦',
    'Australia': 'ğŸ‡¦ğŸ‡º',
    'Brazil': 'ğŸ‡§ğŸ‡·',
    
    # ä¸­æ–‡å›½å®¶å
    'ç¾å›½': 'ğŸ‡ºğŸ‡¸',
    'ä¸­å›½': 'ğŸ‡¨ğŸ‡³',
    'æ—¥æœ¬': 'ğŸ‡¯ğŸ‡µ',
    'éŸ©å›½': 'ğŸ‡°ğŸ‡·',
    'å°åº¦': 'ğŸ‡®ğŸ‡³',
    'è‹±å›½': 'ğŸ‡¬ğŸ‡§',
    'å¾·å›½': 'ğŸ‡©ğŸ‡ª',
    'æ³•å›½': 'ğŸ‡«ğŸ‡·',
    'ä¿„ç½—æ–¯': 'ğŸ‡·ğŸ‡º',
    'åŠ æ‹¿å¤§': 'ğŸ‡¨ğŸ‡¦',
    'æ¾³å¤§åˆ©äºš': 'ğŸ‡¦ğŸ‡º',
    'å·´è¥¿': 'ğŸ‡§ğŸ‡·'
}

def get_section_emoji(section_title):
    if any(ord(c) > 0x1F000 for c in section_title):
        return section_title
    
    for key, emoji in SECTION_EMOJI_MAP.items():
        if key.lower() in section_title.lower():
            return f"{emoji} {section_title}"
    return section_title

def get_title_emoji(title):
    if any(ord(c) > 0x1F000 for c in title):
        return title
        
    for key, emoji in TITLE_KEYWORD_EMOJI_MAP.items():
        if key.lower() in title.lower():
            return f"{emoji} {title}"
    return title

def clean_reading_time(title):
    if not title:
        return title
        
    # æ›´å…¨é¢çš„æ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒ¹é…å¤šç§æ ¼å¼ï¼š
    patterns = [
        r'\s*\([0-9]+ (?:minute|åˆ†é’Ÿ).*?\)',  # (5 minute read) æˆ– (5 åˆ†é’Ÿé˜…è¯»)
        r'\s*\ï¼ˆ[0-9]+ (?:minute|åˆ†é’Ÿ).*?\ï¼‰',  # ï¼ˆ5 minute readï¼‰æˆ–ï¼ˆ5 åˆ†é’Ÿé˜…è¯»ï¼‰- ä¸­æ–‡æ‹¬å·
        r'\s*\([0-9]+(?:m|min).*?\)',  # (5m read) æˆ– (5min read)
        r'\s*\ï¼ˆ[0-9]+(?:m|min).*?\ï¼‰',  # ï¼ˆ5m readï¼‰æˆ–ï¼ˆ5min readï¼‰
        r'\s*[ï¼ˆ(][0-9]+ ?åˆ†é’Ÿ(?:é˜…è¯»)?[)ï¼‰]',  # (5åˆ†é’Ÿ) æˆ– ï¼ˆ5åˆ†é’Ÿé˜…è¯»ï¼‰
        r'\s*ï¼ˆ.*?(?:åˆ†é’Ÿ|minute).*?ï¼‰',  # åŒ¹é…ä»»ä½•åŒ…å«"åˆ†é’Ÿ"æˆ–"minute"çš„ä¸­æ–‡æ‹¬å·å†…å®¹
        r'\s*\(.*?(?:åˆ†é’Ÿ|minute).*?\)',  # åŒ¹é…ä»»ä½•åŒ…å«"åˆ†é’Ÿ"æˆ–"minute"çš„è‹±æ–‡æ‹¬å·å†…å®¹
    ]
    
    # ä¾æ¬¡åº”ç”¨æ‰€æœ‰æ¨¡å¼
    for pattern in patterns:
        title = re.sub(pattern, '', title)
    
    return title.strip()  # ç§»é™¤å¯èƒ½æ®‹ç•™çš„é¦–å°¾ç©ºæ ¼ 